<div class="card-bg">
    <h2 class="card-title text-center mt-0 mb-0">
        <b class="ng-binding">PHIẾU BÁN HÀNG</b>
        <span ng-if="deviceType==0" style="padding-bottom: 12px; padding-left: 8px"
            class="btn tooltip-content-drug ng-scope">
            <span ng-click="">
                <i style="font-size:20px; color: black" class="fa fa-info-circle" aria-hidden="true"></i>
            </span>
            <span style="font-size:14px; text-transform:none" class="show-tooltip-content-drug">
                <b>F1:</b> Thêm mới phiếu trong tab mới<br>
                <b>F2:</b> Tìm khách hàng/nhà cung cấp<br>
                <b>F4:</b> Tính liều<br>
                <b>F8:</b> Thay đổi tổng tiền<br>
                <b>F9:</b> Ghi phiếu<br>
                <b>F11:</b> Toàn màn hình<br>
                <b>↑ và ↓:</b> Đi từ trên xuống<br>
            </span>
        </span>
    </h2>
    <form [formGroup]="formData">
        <div class="text-center card-desc">
            <div class="card-code">
                Mã số: <strong class="ng-binding">{{formData.value?.soPhieuXuat}}</strong>
            </div>
            Ngày: <div class="clickable-text daterange-picker font-weight-bold"><input [hidden]="1==1"
                    formControlName="noteDate" type="text" class="form-control"
                    (dateChange)="onDateChange($event.value)" [matDatepicker]="pickerNgayXuat"
                    (click)="pickerNgayXuat.open()">
                <mat-datepicker #pickerNgayXuat="matDatepicker" disabled="false"></mat-datepicker><span
                    class="text-link" (click)="pickerNgayXuat.open()">{{formData.value.id == 0 ?
                    (formData.value.ngayXuat | appDate) :formData.value.ngayXuat | appDateTime}}</span>
            </div>
        </div>
        <div *ngIf="(isDesktop() || isTablet()) && ( isAdminUser || formData.value?.id <= 0)">
            <table>
                <tbody>
                    <tr>
                        <td>
                            <label style="font-size:14px; padding-right: 10px;" class="control-label">Nhân viên bán
                                 </label>
                        </td>
                        <td style="width: 70%;">
                            <div class="flex-grow-1 ip-position ng-isolate-scope">
                                <ng-select appendTo="body" formControlName="createdByUserId" appearance="outline"
                                    [items]="listNhanViens" bindLabel="tenDayDu" bindValue="id"
                                    placeholder="Tra cứu theo tên..." notFoundText="Không tìm thấy mục nào">
                                    <ng-template ng-label-tmp let-item="item">
                                        <span>{{item.tenDayDu}}</span>
                                    </ng-template>
                                    <ng-template ng-option-tmp let-item="item" let-index="index"
                                        let-search="searchTerm">
                                        <span [ngOptionHighlight]="search">{{item.tenDayDu}}
                                        </span>
                                    </ng-template>
                                </ng-select>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </form>
    <div class="mt-3">
        <form [formGroup]="formData">
            <table class="table borderless table-condensed" style="margin-bottom:0px;"
                *ngIf="isDesktop() || isTablet()">
                <tbody>
                    <tr>
                        <td class="w-50">
                            <div class="form-inline-flex">
                                <label>
                                    <span ng-if="viewModel.NoteTypeId==2" class="ng-scope">Khách hàng:</span>
                                </label>
                                <div class="input-group">
                                    <div class="flex-grow-1 ip-position ng-isolate-scope">
                                        <ng-select appendTo="body"
                                            formControlName="khachHangMaKhachHang"
                                            appendTo="body"
                                            appearance="outline" 
                                            [items]="listKhachHang$ | async" 
                                            [typeahead]="searchKhachHangTerm$"
                                            bindLabel="tenKhachHang"
                                            bindValue="id" 
                                            [minTermLength]="2"
                                            appendTo="body" 
                                            appearance="outline"
                                            placeholder="Tra cứu theo tên, mã, mã vạch..."
                                            notFoundText="Không tìm thấy mục nào" (change)="searchKhachHangTerm$.next(''); onCustomerChange($event)">
                                            <ng-template ng-label-tmp let-item="item">
                                                <span *ngIf="item.tenKhachHang">{{item.tenKhachHang}}</span>
                                                <span *ngIf="!item.tenKhachHang">{{formData.value?.khachHang.tenKhachHang}}</span>
                                            </ng-template>
                                            <ng-template ng-option-tmp let-item="item" let-index="index"
                                                let-search="searchTerm">
                                                <span
                                                    [ngOptionHighlight]="search">{{item.tenKhachHang}}-{{item.soDienThoai}}-
                                                    {{item.diaChi}}</span>
                                            </ng-template>
                                        </ng-select>
                                    </div>

                                    <div class="input-group-btn">

                                        <button class="btn btn-primary" title="Thêm mới khách hàng nếu chưa có"
                                            (click)="openAddCustomerDialog()">
                                            <i class="fa-regular fa-plus"></i>
                                        </button>

                                        <input type="button" value="LS"
                                            title="Chi tiết lịch sử giao dịch của khách hàng"
                                            class="btn btn-primary btn-not-radius"
                                            (click)="openTransaction()">
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="w-50" *ngIf="isDesktop() || isTablet()">
                            <div class="d-flex gap-10 align-items-center">
                                <div class="form-inline-flex w-25">
                                    <label>
                                        Liều:
                                    </label>
                                    <div class="input-group">
                                        <input type="text"
                                            class="number-input form-control mb-0 ng-pristine ng-untouched ng-valid ng-isolate-scope ng-valid-number ng-valid-min ng-valid-max ng-valid-step ng-valid-external"
                                            refresh-delay="500" id="factors" style="width: 40%;"
                                            ng-model="viewModel.Factors" min="1" max="30" step="0.5"
                                            awnum="app-decimal-number">
                                        <span class="input-group-btn">
                                            <button type="button" class="btn btn-primary"
                                                ng-click="onDoseCalculation($event)"><i
                                                    class="fa-regular fa-calculator"></i></button>
                                        </span>
                                    </div>
                                </div>
                                <div class="form-inline-flex w-50">
                                    <label>Bác sỹ:</label>
                                    <div class="input-group align-items-start">
                                        <div class="flex-grow-1 ip-position ng-isolate-scope">
                                            <ng-select appendTo="body" formControlName="bacSyMaBacSy"
                                                appearance="outline" [items]="listBacSys" bindLabel="tenBacSy"
                                                bindValue="id" placeholder="Tra cứu theo tên..."
                                                notFoundText="Không tìm thấy mục nào">
                                                <ng-template ng-label-tmp let-item="item">
                                                    <span>{{item.tenBacSy}}</span>
                                                </ng-template>
                                                <ng-template ng-option-tmp let-item="item" let-index="index"
                                                    let-search="searchTerm">
                                                    <span
                                                        [ngOptionHighlight]="search">{{item.tenBacSy}}-{{item.soDienThoai}}
                                                    </span>
                                                </ng-template>
                                            </ng-select>
                                        </div>
                                        <div class="input-group-btn">
                                            <button class="btn btn-primary" (click)="openAddDoctorDialog()"
                                                title="Thêm bác sỹ mới nếu chưa có">
                                                <i class="fa-regular fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <label>Tổng điểm: <span class="text-danger ng-binding">{{totalScore |
                                            number}}</span></label>
                                    <label ng-if="receiverSelectedItem.TypeId != 1" style="padding-left: 10px;">Tổng nợ:
                                        <span class="text-danger ng-binding">{{totalDebtAmount | number}}</span></label>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr *ngIf="enableElectronicInvoice && isDesktop() || isTablet()">
                        <td class="w-50" style="padding-right: 10px;">
                            <div class="d-flex gap-10 align-items-center justify-content-between">
                                <div class="form-inline-flex">
                                    <label>Số hóa đơn:</label>
                                    <input type="text" class="form-control mb-0 ng-pristine ng-untouched ng-valid"
                                        formControlName="invoiceNo" placeholder="Số hóa đơn">
                                </div>
                                <div class="form-inline-flex">
                                    <label>Ngày hóa đơn:</label>
                                    <div class="input-group">
                                        <div>
                                            <input formControlName="invoiceDate" type="text" class="form-control"
                                                [matDatepicker]="pickerInvoiceDate" (click)="pickerInvoiceDate.open()">
                                            <mat-datepicker #pickerInvoiceDate="matDatepicker"
                                                disabled="false"></mat-datepicker>
                                            <span class="input-group-btn">
                                                <button type="button" class="btn btn-primary"
                                                    (click)="pickerInvoiceDate.open()">
                                                    <i class="fa-regular fa-calendar-days"></i></button>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="w-50">
                            <div class="form-inline-flex">
                                <label>Mã cơ sở bán:</label>
                                <input type="text" class="form-control mb-0 ng-pristine ng-untouched ng-valid"
                                    ng-readonly="true" formControlName="nationalFacilityCode" readonly="readonly">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </form>

        <!-- ngIf: deviceType!=0 -->
        <table mat-table class="table table-striped table-hover tr-ng-grid" [dataSource]="getDataSource()">
            <ng-container matColumnDef="#">
                <th mat-header-cell *matHeaderCellDef style="width:3%"> #</th>
                <td mat-cell *matCellDef="let data; index as i;" class="text-center">
                    <a *ngIf="data.isEditingItem" class="btn btn-primary" title="Thêm mới" (click)="onAddNew(data)"><i
                            class="fa-regular fa-plus"></i></a>
                    <a *ngIf="!data.isEditingItem" class="btn btn-danger" title="Xóa" (click)="onDelete(data)"><i
                            class="fa-regular fa-trash"></i></a>
                </td>
            </ng-container>
            <ng-container matColumnDef="stt">
                <th mat-header-cell *matHeaderCellDef style="width:5%"> STT</th>
                <td mat-cell *matCellDef="let data; index as i;" class="text-center" style="vertical-align: middle;">
                    <select class="form-control" (ngModelChange)="changeLoaiGiaBan()" [(ngModel)]="loaiGiaBan"
                        *ngIf="data.isEditingItem">
                        <option value="0">Lẻ</option>
                        <option value="1">Sỉ</option>
                    </select>
                    <span *ngIf="!data.isEditingItem" (click)="openDetailDialog(data.thuocThuocId)"
                        class="btn-link">{{data.itemOrder}}</span>
                </td>
            </ng-container>

            <ng-container matColumnDef="anh">
                <th mat-header-cell *matHeaderCellDef> Ảnh </th>
                <td mat-cell *matCellDef="let data" class="text-right">

                </td>
            </ng-container>

            <ng-container matColumnDef="matHang">
                <th mat-header-cell *matHeaderCellDef style="width:25%">Mặt Hàng [Mã-Tên]</th>
                <td mat-cell *matCellDef="let data" style="vertical-align: middle;">
                    <div *ngIf="data.isEditingItem">
                        <div>
                            <div class="w-100">
                                <div class="input-group">
                                    <ng-select #selectDrug 
                                        class="w-100"
                                        appendTo="body" 
                                        [(ngModel)]="data.thuocThuocId"
                                        appearance="outline" 
                                        [items]="listThuoc$ | async" 
                                        [typeahead]="searchThuocTerm$"
                                        bindLabel="tenThuoc"
                                        bindValue="id" 
                                        [minTermLength]="2"
                                        appendTo="body" 
                                        appearance="outline"
                                        placeholder="Tra cứu theo tên, mã, mã vạch..."
                                        notFoundText="Không tìm thấy mục nào" (change)="searchThuocTerm$.next(''); onDrugChange($event)">
                                        <ng-template ng-label-tmp let-item="item">
                                            <span *ngIf="item.maThuoc">{{item.maThuoc}}-{{item.tenThuoc}}</span>
                                            <span *ngIf="!item.maThuoc">{{drugDefault.maThuoc}} - {{drugDefault.tenThuoc}}</span>
                                        </ng-template>
                                        <ng-template ng-option-tmp let-item="item" let-index="index"
                                            let-search="searchTerm">
                                            <span [ngOptionHighlight]="search">{{item.maThuoc}}-{{item.tenThuoc}}-
                                                {{item.tenDonViTinhXuatLe}} - Gián bán : {{item.giaBanLe
                                                |number}}</span>
                                        </ng-template>
                                    </ng-select>
                                    <div class="input-group-btn">

                                        <button class="btn btn-primary" title="Thêm mới mặt hàng nếu chưa có"
                                            (click)="openAddDrugDialog()">
                                            <i class="fa-regular fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <span *ngIf="!data.isEditingItem">{{data.maThuocText}} - {{data.tenThuocText}}</span>
                </td>
            </ng-container>
            <ng-container matColumnDef="donVi">
                <th mat-header-cell *matHeaderCellDef style="width: 10%;"> Đơn vị</th>
                <td mat-cell *matCellDef="let data" style="vertical-align: middle;">
                    <select class="form-control" [(ngModel)]="data.donViTinhMaDonViTinh" (change)="onChangeUnit(data)">
                        <option *ngFor="let i of data.donViTinhs" value="{{i.id}}">
                            {{i.tenDonViTinh}}
                        </option>
                    </select>
                </td>
            </ng-container>
            <ng-container matColumnDef="soLuong">
                <th mat-header-cell *matHeaderCellDef style="width:5%"> Số lượng</th>
                <td mat-cell *matCellDef="let data" style="vertical-align: middle;">
                    <input type="text" #inputSoLuong [(ngModel)]="data.soLuong" (change)="getItemAmount(data)"
                        (keyup.enter)="onAddNew(data)" class="form-control text-right">
                </td>
            </ng-container>
            <ng-container matColumnDef="donGia">
                <th mat-header-cell *matHeaderCellDef style="width:10%">Đơn giá</th>
                <td mat-cell *matCellDef="let data" style="vertical-align: middle;">
                    <input type="text" [(ngModel)]="data.giaXuat" (change)="getItemAmount(data)"
                        class="form-control text-right" />
                </td>
            </ng-container>
            <ng-container matColumnDef="ck">
                <th mat-header-cell *matHeaderCellDef style="width:10%"> C.K(%)</th>
                <td mat-cell *matCellDef="let data" style="vertical-align: middle;">
                    <input type="text" [(ngModel)]="data.chietKhau" (change)="getItemAmount(data)"
                        class="form-control text-right" />
                </td>
            </ng-container>
            <ng-container matColumnDef="vat">
                <th mat-header-cell *matHeaderCellDef style="width:10%">VAT(%)</th>
                <td mat-cell *matCellDef="let data" style="vertical-align: middle;">
                    <input type="text" [(ngModel)]="data.vat" (change)="getItemAmount(data)"
                        class="form-control text-right" />
                </td>
            </ng-container>
            <ng-container matColumnDef="loHan" style="width:10%">
                <th mat-header-cell *matHeaderCellDef>Lô/Hạn</th>
                <td mat-cell *matCellDef="let data">
                    <div class="input-group d-flex gap-10" style="z-index:0">
                        <span class="text-left">
                            <button class="btn {{getBatchExpiryCss(data)}}" (click)="openUpdateBatchDialog(data)">
                                <span><i class="fa-regular fa-calendar-days"></i></span>
                            </button>
                        </span>
                        <span>{{getBatchNumberAndExpDate(data)}}</span>
                    </div>
                </td>
            </ng-container>
            <ng-container matColumnDef="ton">
                <th mat-header-cell *matHeaderCellDef>Tồn</th>
                <td mat-cell *matCellDef="let data" class="text-center" style="vertical-align: middle;">
                    {{data.tonHT | number}}
                </td>
            </ng-container>
            <ng-container matColumnDef="thanhTien">
                <th mat-header-cell *matHeaderCellDef>Thành tiền</th>
                <td mat-cell *matCellDef="let data" class="text-center" style="vertical-align: middle;">
                    {{ data.tongTien | number}}
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="getDisplayedColumns(); sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: getDisplayedColumns();"></tr>

        </table>

        <form [formGroup]="formData">
            <table class="borderless table-condensed">
                <tbody>
                    <tr>
                        <td class="w-50">
                            <div class="d-flex gap-10 align-items-center justify-content-between">
                                <div class="form-inline-flex flex-grow-1">
                                    <label>Tổng tiền:</label>
                                    <div class="flex-grow-1">
                                        <label class="control-label ng-binding"
                                            *ngIf="!allowChangeTotalAmountInDeliveryNote">{{formData.value?.tongTien |
                                            number}}</label>
                                        <input type="text"
                                            class="form-control mb-0 ng-pristine ng-untouched ng-valid ng-isolate-scope"
                                            style="width: 100%" formControlName="tongTien" awnum="app-int-number"
                                            *ngIf="allowChangeTotalAmountInDeliveryNote"
                                            ng-keypress="onTotalAmountChanged($event)">
                                    </div>
                                </div>
                                <div class="form-inline-flex flex-grow-1" *ngIf="deliveryNoteDiscountTotalByValue">
                                    <label>C.K.Đơn</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control mb-0" formControlName="discount"
                                            (change)="onDiscountChange('tien')">
                                        <span style="padding: 5px 5px 5px 5px"
                                            class="input-group-addon flex-grow-width-auto">VNĐ</span>
                                    </div>
                                    <div class="input-group">
                                        <input style="max-width: 70px" type="text" class="form-control mb-0"
                                            formControlName="discountWithRatio"
                                            (change)="onDiscountChange('phan tram')">
                                        <span style="padding: 5px 5px 5px 5px"
                                            class="input-group-addon flex-grow-width-auto">%</span>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="w-50">
                            <div class="d-flex gap-10 align-items-center justify-content-between">
                                <div class="form-inline-flex flex-grow-1 ng-scope" ng-if="viewModel.NoteTypeId==2">
                                    <label>Trả điểm: </label>
                                    <input type="text"
                                        class="number-input form-control mb-0 ng-untouched ng-isolate-scope ng-valid-min ng-valid-max ng-valid-step ng-valid-external ng-dirty ng-valid ng-valid-number"
                                        style="width:90px;" formControlName="paymentScore" awnum="app-decimal-number"
                                        refresh-delay="500" (change)="onPaymentScoreChange()" placeholder="Điểm trả"
                                        id="paymentScore">
                                </div>
                                <div ng-if="viewModel.NoteTypeId==2 || viewModel.NoteTypeId == 4"
                                    class="form-inline-flex flex-grow-1 ng-scope">
                                    <label>Trả: </label>
                                    <div class="input-group">
                                        <input type="text"
                                            class="form-control mb-0 mousetrap ng-pristine ng-untouched ng-valid ng-isolate-scope"
                                            style="width: 100%" formControlName="daTra">
                                        <input type="button" value="F" class="btn btn-primary"
                                            title="Ấn vào đây để trả đủ số tiền" (click)="onPaymentFull()">
                                    </div>
                                </div>
                            </div>

                        </td>
                    </tr>
                    <tr class="ng-scope">
                        <td class="w-50"></td>
                        <td>
                            <div class="d-flex gap-10">
                                <div>
                                    <div class="msg_payment_header msg_payment_expanded">Hình thức thanh toán
                                        <span style="cursor: pointer;" (click)="expandForm()">{{expandLabel}}</span>
                                    </div>
                                    <div id="paymentSlide" *ngIf="showMoreForm" class="form-check">
                                        <mat-radio-group class="tp-radio-group" formControlName="paymentTypeId">
                                            <mat-radio-button class="tp-radio-button"
                                                *ngFor="let item of listPaymentType" [value]="item.id">
                                                {{item.displayName}}
                                            </mat-radio-button>
                                        </mat-radio-group>
                                    </div>
                                    <div>
                                        <span style="text-align: left;width:100px"><label
                                                class="mb-0 ng-binding">{{debtLabel}}:</label>
                                        </span>
                                        <span style="text-align: left; color: red">
                                            <label class="control-label ng-binding">{{getDebtAmount() | number}}</label>
                                        </span>
                                    </div>
                                </div>

                            </div>
                        </td>
                    </tr><!-- end ngIf: viewModel.NoteTypeId==2 || viewModel.NoteTypeId == 4 -->
                </tbody>
            </table>

            <table class="table borderless table-condensed" style="padding: 5px">
                <tbody>
                    <tr ng-show="viewModel.DoctorId > 0" class="ng-hide">
                        <td>
                            <div class="d-flex gap-10 text-left">
                                <label>Bệnh theo chuẩn bộ y tế</label>
                                <div style="width: 100%">
                                    <div item-search-filter="" select-changed-callback="onDiagnosticItemChanged"
                                        clear-after-selected="true" only-single-item="true"
                                        default-selected-item="diagnosticSelectedItem" show-cam-barcode-scanner="false"
                                        handle-broadcast="true" search-type="9" class="ng-isolate-scope">

                                        <div ng-if="!showCamBarcodeScanner" class="">
                                            <div class="w-100">
                                                <div class="ui-select-container ui-select-multiple ui-select-bootstrap dropdown form-control ng-valid"
                                                    ng-class="{open: $select.open}" ng-model="data.selected"
                                                    theme="bootstrap" id="itemSearchId"
                                                    reset-search-input="clearAfterSelected"
                                                    forward-enter-key="forwardEnterKey" ng-disabled="disabledMode">
                                                    <div><span
                                                            class="text-truncate-line ui-select-match ui-select-match"
                                                            placeholder="Nhập mã hoặc tên bệnh..."
                                                            id="itemSearchUISelectID"></span><input type="search"
                                                            autocomplete="off" autocorrect="off" autocapitalize="off"
                                                            spellcheck="false"
                                                            class="ui-select-search input-xs ng-pristine ng-untouched ng-valid"
                                                            placeholder="Nhập mã hoặc tên bệnh..."
                                                            ng-disabled="$select.disabled" ng-click="$select.activate()"
                                                            ng-model="$select.search" role="combobox"
                                                            aria-expanded="false" aria-label="Select box"
                                                            ng-class="{'spinner': $select.refreshing}"
                                                            ondrop="return false;" style="width: 10px;"></div>
                                                    <ul class="itemSelectChoices ui-select-choices ui-select-choices-content ui-select-dropdown dropdown-menu ng-hide"
                                                        ng-show="$select.open &amp;&amp; $select.items.length > 0"
                                                        refresh="fetch($select)" refresh-delay="500"
                                                        repeat="item in items" id="selectChoiceId">
                                                        <li class="ui-select-choices-group" id="ui-select-choices-46">
                                                            <div class="divider ng-hide"
                                                                ng-show="$select.isGrouped &amp;&amp; $index > 0"></div>
                                                            <div ng-show="$select.isGrouped"
                                                                class="ui-select-choices-group-label dropdown-header ng-binding ng-hide"
                                                                ng-bind="$group.name"></div>

                                                        </li>
                                                    </ul>
                                                    <div class="ui-select-no-choice"></div>

                                                </div>
                                            </div>


                                        </div>
                                        <span id="Logo" style="display:none;"></span>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr ng-show="viewModel.DoctorId > 0" class="ng-hide">
                        <td>
                            <div class="d-flex gap-10 text-left">
                                <label>Chẩn đoán của B.S</label>
                                <textarea class="form-control mb-0 ng-pristine ng-untouched ng-valid"
                                    style="width: 100%" formControlName="doctorComments"></textarea>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="d-flex gap-10 text-left">
                                <label>Diễn giải:</label>
                                <textarea class="form-control mb-0 ng-pristine ng-untouched ng-valid"
                                    style="width: 100%" formControlName="dienGiai"></textarea>
                            </div>
                        </td>
                    </tr>
                    <tr ng-show="enableNotifyNextPurchase &amp;&amp; viewModel.NoteTypeId==2" class="ng-hide">
                        <td>
                            <div class="d-flex gap-10 text-left">
                                <label>Ngày mua thuốc tiếp theo</label>
                                <input
                                    class="input-datetime form-control mb-0 text-box single-line ng-pristine ng-untouched ng-valid"
                                    style="text-align:left" type="text" placeholder="dd/mm/yyyy"
                                    ng-model="viewModel.NextPurchaseDate" ng-change="onNextPurchaseDateChanged()">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table borderless table-condensed">
                <tbody>
                    <tr>
                        <td colspan="2">
                            <div class="d-flex justify-content-center align-items-center gap-10">
                                <input type="button" value="Quay lại" class="btn btn-default"
                                    (click)="onReturnListing()">
                                <input type="submit" value="Ghi Phiếu - F9"
                                    disabled="{{formData.value?.locked ? 'disabled' : ''}}" id="save-note-btn-id"
                                    title="F9-Ghi phiếu" class="btn btn-primary" class="btn btn-primary"
                                    (click)="onSave()">
                                <button class="btn btn-default" title="Sao chép phiếu"
                                    disabled="{{formData.value?.locked ? 'disabled' : ''}}"
                                    *ngIf="isDesktop() && formData.value?.id > 0"
                                    ng-click="onCopyNoteDelivery(viewModel.NoteId)">Copy</button>
                                <div class="btn-group ng-scope" *ngIf="isDesktop() && formData.value?.id > 0">
                                    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"
                                        aria-haspopup="true" aria-expanded="false">
                                        In <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a href="#" ng-click="onPrint(4)">Phiếu khách lẻ - 58mm</a></li>
                                        <li><a href="#" ng-click="onPrint(3)">Phiếu khách lẻ - 80mm</a></li>
                                        <li><a href="#" ng-click="onPrint(2)">Phiếu khách lẻ - A5</a></li>
                                        <li><a href="#" ng-click="onPrint(1)">Phiếu khách quen - A4</a></li>
                                        <li><a href="#" ng-click="onPrint(5)">In liều dùng</a></li>
                                        <li class="divider"></li>
                                        <li>
                                            <a href="/Thuocs/InMaVach?MaPhieu=35432435&amp;LoaiPhieu=2" target="_blank">
                                                In mã vạch thuốc
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <span *ngIf="formData.value?.id > 0" class="ng-scope">
                                    <span>&nbsp;</span>
                                    <button class="btn btn-danger"
                                        disabled="{{formData.value?.locked ? 'disabled' : ''}}"
                                        (click)="delete('Bạn có chắc chắn muốn xóa phiếu xuất bán của khách hàng \'' +
                    formData.value?.khachHangMaKhachHangText + '\' có số phiếu \'' + formData.value?.soPhieuXuat + '\' ?', formData.value?.id)">
                                        Xóa phiếu</button>
                                    <span>&nbsp;</span>
                                    <a (click)="onLockNote()" title="Mở/Khóa phiếu" class="btn btn-default"><i
                                            class="fa {{formData.value?.locked ? 'fa-lock' : 'fa-unlock'}} fa-lg"></i></a>
                                </span>
                                <span *ngIf="enableElectronicInvoice" class="ng-scope">
                                    <input disabled="{{formData.value?.locked ? 'disabled' : ''}}" type="file"
                                        ngf-select="uploadXmlInvoiceFiles($file, $invalidFiles)" style="display: none;"
                                        id="chooseXmlInvoiceFileId" accept="text/xml" ngf-max-size="10MB"
                                        value="Tải file" class="btn btn-default">
                                    <input disabled="{{formData.value?.locked ? 'disabled' : ''}}" type="button"
                                        value="Đọc HĐ" class="btn btn-warning"
                                        ng-click="onSelectXmlInvoiceFileToImport(); $event.preventDefault(); $event.stopPropagation();">
                                </span>
                            </div>
                        </td>
                    </tr>
                    <tr *ngIf="formData.value?.id > 0" class="ng-scope">
                        <td colspan="2" class="text-center">
                            <div class="d-flex justify-content-center align-items-center gap-10">
                                <span class="ng-binding">[Người lập: {{formData.value?.createdByUserText}}] - [Ngày lập:
                                    {{formData.value?.created | appDate}}]</span>
                            </div>
                        </td>
                    </tr><!-- end ngIf: viewModel.TaskMode==2 -->
                </tbody>
            </table>
        </form>
    </div>
</div>