<div class="row">
  <div class="col-md-3">
    <form [formGroup]="formData">
      <div class="sidebar-bg">
        <div class="mb-3">
          <label>Loại phiếu</label>
          <select class="form-control" formControlName="loaiPhieu">
            <option *ngFor="let i of loaiPhieus" label="{{i.value}}" value="{{i.id}}">{{i.value}}</option>
          </select>
        </div>
        <div class="mb-3">
          <label>Mã số phiếu</label>
          <div>
            <input type="number" class="form-control" formControlName="soPhieu" placeholder="Nhập số phiếu...">
          </div>
        </div>
        <div class="mb-3" *ngIf="formData.get('loaiPhieu')?.value == 1 || formData.get('loaiPhieu')?.value == 7">
          <label>Khách hàng</label>
          <div class="control-group">
            <ng-select appendTo="body" formControlName="createdBy_UserId" appearance="outline" [items]="listKhachHang"
              bindLabel="tenKhachHang" bindValue="id" placeholder="Tra cứu theo tên..."
              notFoundText="Không tìm thấy mục nào" refresh-delay="500" (search)="searchObject($event)">
              <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
                <span [ngOptionHighlight]="search">{{item.tenKhachHang}}-{{item.soDienThoai}}- {{item.diaChi}}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
        <div class="mb-3" *ngIf="formData.get('loaiPhieu')?.value == 2 || formData.get('loaiPhieu')?.value == 6">
          <label>Nhà cung cấp</label>
          <div class="control-group">
            <ng-select appendTo="body" formControlName="createdBy_UserId" appearance="outline" [items]="listNhaCungCap"
              bindLabel="tenNhaCungCap" bindValue="id" placeholder="Tra cứu theo tên..."
              notFoundText="Không tìm thấy mục nào" refresh-delay="500" (search)="searchObject($event)">
              <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
                <span [ngOptionHighlight]="search">{{item.tenNhaCungCap}}-{{item.soDienThoai}}- {{item.diaChi}}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
        <div class="mb-3" *ngIf="formData.get('loaiPhieu')?.value == 3 || formData.get('loaiPhieu')?.value == 4
                  || formData.get('loaiPhieu')?.value == 5">
          <label>Đối tác</label>
          <input type="text" class="form-control" formControlName="nguoiNhan" placeholder="Nhập tên đối tác...">
        </div>
        <div class="mb-3">
          <label>Nhân viên</label>
          <div class="control-group">
            <ng-select appendTo="body" formControlName="createdBy_UserId" appearance="outline" [items]="listNhanVien"
              bindLabel="tenDayDu" bindValue="id" placeholder="Tra cứu theo tên..."
              notFoundText="Không tìm thấy mục nào">
              <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
                <span [ngOptionHighlight]="search">{{item.tenDayDu}}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
        <fieldset class="baocao-filter">
          <app-date-range-filter [filterType]="0" (filterTypeChange)="changeFilterType($event)"
            (fromDateChange)="changeFromDate($event)" (toDateChange)="changeToDate($event)"></app-date-range-filter>
        </fieldset>
        <input type="button" value="Xem" id="btnDisplayDataByDateRange" name="btnDisplayDataByDateRange"
          class="btn btn-primary w-100" (click)="fetchData()">
      </div>
    </form>
  </div>
  <div class="col-md-9">
    <div class="baocao-container box-group-white">
      <h2 class="mb-3 d-block text-center"><b>{{ title }}</b></h2>
      <div class="number-value mb-3 d-flex align-items-center justify-content-end gap-10">
        <strong>Tiền mặt : {{tienMat | number}}</strong><strong>Chuyển khoản : {{chuyenKhoan | number}}</strong>
      </div>
      <table mat-table class="table table-striped table-bordered table-hover tr-ng-grid" [dataSource]="getDataSource()"
        matSort>
        <ng-container matColumnDef="#">
          <th mat-header-cell *matHeaderCellDef style="width:5%"> #</th>
          <td mat-cell *matCellDef="let data; index as i;" style="width:8%" class="text-right">
            <span class="btn-link">{{ (page - 1) * pageSize + i + 1
              }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="soPhieu">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Số phiếu</th>
          <td mat-cell *matCellDef="let data" class="text-right"> {{ data.soPhieu }}</td>
        </ng-container>

        <ng-container matColumnDef="nguoiNhan">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Đối tác</th>
          <td mat-cell *matCellDef="let data"> {{ data.nguoiNhan }}</td>
        </ng-container>
        <ng-container matColumnDef="ngayTao">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Ngày tạo</th>
          <td mat-cell *matCellDef="let data"> {{ data.ngayTao | appDateTime }}</td>
        </ng-container>
        <ng-container matColumnDef="createBy_UserName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Nhân viên</th>
          <td mat-cell *matCellDef="let data"> {{ data.createBy_UserName }}</td>
        </ng-container>
        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef width="10%" mat-sort-header>
            Số tiền<br />Σ = {{tongTien | number}}</th>
          <td mat-cell *matCellDef="let data" class="text-right"> {{ data.amount | number }}</td>
        </ng-container>
        <ng-container matColumnDef="dienGiai">
          <th mat-header-cell *matHeaderCellDef> Diễn giải</th>
          <td mat-cell *matCellDef="let data"> {{ data.dienGiai }}</td>
        </ng-container>
        <ng-container matColumnDef="httt">
          <th mat-header-cell *matHeaderCellDef> HTTT</th>
          <td mat-cell *matCellDef="let data"> {{data.paymentTypeId == 0 ? '(Tiền mặt)' : '(chuyển khoản)'}}</td>
        </ng-container>
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let data">
            <div class="baocao-actions">
              <button class="btn btn-sm btn-primary"><i class="fa-regular fa-pen-to-square"></i></button>
              <button class="btn btn-sm btn-danger"
                (click)="delete('Bạn có chắc chắn muốn xóa phiếu số \'' + data.soPhieu + ' đối tác ' + data.nguoiNhan + '\' ?', data)">
                <i class="fa-regular fa-trash"></i></button>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="footer">
          <td mat-footer-cell *matFooterCellDef colspan="100">
            <app-pagination [currentPage]="page" [totalPages]="totalPages" [totalRecord]="totalRecord"
              (pageChange)="changePageIndex($event)" (pageSizeChange)="changePageSize($event)"></app-pagination>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        <tr mat-footer-row *matFooterRowDef="['footer']"></tr>

      </table>
    </div>
  </div>
</div>